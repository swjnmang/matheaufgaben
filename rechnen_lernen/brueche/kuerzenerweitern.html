<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Br√ºche k√ºrzen und erweitern - √úbungen</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f5f5f5;
        }
        h1, h2 {
            color: #2c3e50;
            text-align: center;
        }
        .container {
            background-color: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        .difficulty-selector {
            display: flex;
            justify-content: center;
            margin-bottom: 20px;
        }
        .difficulty-btn {
            padding: 10px 20px;
            margin: 0 10px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-weight: bold;
            transition: all 0.3s;
        }
        .difficulty-btn:hover {
            transform: translateY(-2px);
        }
        #easy {
            background-color: #2ecc71;
            color: white;
        }
        #medium {
            background-color: #f39c12;
            color: white;
        }
        #hard {
            background-color: #e74c3c;
            color: white;
        }
        .task-container {
            background-color: #f9f9f9;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
            text-align: center;
            font-size: 20px;
        }
        .exercise-type {
            font-weight: bold;
            margin-bottom: 10px;
            color: #7f8c8d;
        }
        /* Style for fractions in the task display */
        .fraction {
            display: inline-block;
            vertical-align: middle;
            text-align: center;
            font-size: 24px; /* Keep original font size for task */
        }
        .fraction .num {
            display: block;
            border-bottom: 1px solid black;
            padding: 0 5px;
        }
        .fraction .den {
            display: block;
            padding: 0 5px;
        }
        .operation {
            margin: 0 15px;
            font-size: 24px;
            vertical-align: middle;
            display: inline-block;
        }
        .input-container {
            margin: 20px 0;
            text-align: center;
        }
        input[type="number"] { /* General style for number inputs, might be overridden */
            width: 60px;
            height: 30px;
            font-size: 18px;
            text-align: center;
            margin: 0 5px;
            border: 1px solid #bdc3c7;
            border-radius: 5px;
        }

        /* --- Start: NEW/MODIFIED CSS for Fraction Input --- */
        .fraction-input {
            display: inline-block; /* Erlaubt Zentrierung im input-container */
            vertical-align: middle;
        }

        .fraction-input .fraction {
             display: inline-block; /* Wichtig f√ºr die Struktur */
             vertical-align: middle;
             text-align: center;
             font-size: 18px; /* Adjust font size for input if needed */
        }

        .fraction-input input.num {
            display: block; /* Stellt sicher, dass es √ºber dem Nenner steht */
            width: 60px;
            text-align: center;
            padding: 5px;
            font-size: 18px;
            border: 1px solid #bdc3c7;
            border-bottom: none; /* Kein unterer Rand, da der Bruchstrich kommt */
            border-radius: 5px 5px 0 0; /* Oben abrunden */
            margin: 0 auto;
            box-sizing: border-box;
        }

        .fraction-input .fraction-line {
            display: block; /* Eigenes Block-Element */
            border-top: 2px solid black; /* Deutlicher Bruchstrich */
            margin: 0 auto; /* Zentriert */
            width: 60px; /* Gleiche Breite wie Inputs */
            padding: 0;
            height: 0;
            line-height: 0;
        }

        .fraction-input input.den {
            display: block; /* Stellt sicher, dass es unter dem Z√§hler steht */
            width: 60px;
            text-align: center;
            padding: 5px;
            font-size: 18px;
            border: 1px solid #bdc3c7;
            border-top: none; /* Kein oberer Rand */
            border-radius: 0 0 5px 5px; /* Unten abrunden */
            margin: 0 auto;
            box-sizing: border-box;
        }
         /* --- End: NEW/MODIFIED CSS for Fraction Input --- */

        .buttons {
            text-align: center;
            margin: 20px 0;
        }
        button {
            padding: 10px 20px;
            margin: 0 10px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-weight: bold;
            transition: all 0.3s;
        }
        #check-btn {
            background-color: #3498db;
            color: white;
        }
        #next-btn {
            background-color: #9b59b6;
            color: white;
        }
        #solution-btn {
            background-color: #34495e;
            color: white;
        }
        button:hover {
            transform: translateY(-2px);
            box-shadow: 0 2px 5px rgba(0,0,0,0.2);
        }
        .feedback {
            text-align: center;
            margin: 20px 0;
            padding: 10px;
            border-radius: 5px;
            font-weight: bold;
        }
        .correct {
            background-color: #dff0d8;
            color: #3c763d;
        }
        .incorrect {
            background-color: #f2dede;
            color: #a94442;
        }
        .solution {
            display: none;
            background-color: #d9edf7;
            color: #31708f;
            padding: 15px;
            border-radius: 5px;
            margin-top: 20px;
            text-align: center;
        }
        .stats {
            display: flex;
            justify-content: space-around;
            margin-top: 30px;
            padding: 10px;
            background-color: #e8f4f8;
            border-radius: 5px;
        }
        .stat-item {
            text-align: center;
        }
        .stat-value {
            font-size: 24px;
            font-weight: bold;
            color: #2980b9;
        }
        .streak {
            position: relative;
            text-align: center;
        }
        .streak-count {
            font-size: 30px;
            font-weight: bold;
            color: #e67e22;
        }
        .streak-label {
            font-size: 12px;
            color: #7f8c8d;
        }
        .streak-flame {
            font-size: 24px;
            margin-right: 5px;
        }
        .instructions {
            background-color: #f1f1f1;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
        }
        @media (max-width: 600px) {
            .difficulty-selector {
                flex-direction: column;
                align-items: center;
            }
            .difficulty-btn {
                margin: 5px 0;
                width: 200px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>Br√ºche k√ºrzen und erweitern</h1>

        <div class="instructions">
            <h3>Anleitung:</h3>
            <p>1. W√§hle eine Schwierigkeitsstufe.</p>
            <p>2. L√∂se die angezeigten Aufgaben zum K√ºrzen oder Erweitern von Br√ºchen.</p>
            <p>3. Trage deine Antwort als Bruch (Z√§hler oben, Nenner unten) ein und √ºberpr√ºfe sie.</p>
            <p>4. Mit jedem richtigen Ergebnis erh√∂ht sich dein Streak!</p>
        </div>

        <div class="difficulty-selector">
            <button id="easy" class="difficulty-btn">Leicht</button>
            <button id="medium" class="difficulty-btn">Mittel</button>
            <button id="hard" class="difficulty-btn">Schwer</button>
        </div>

        <div class="task-container" id="task-display" style="display: none;">
            <div class="exercise-type" id="exercise-type"></div>
            <div class="task" id="task"></div>
            <div class="input-container" id="input-container"></div>
        </div>

        <div class="buttons" id="buttons" style="display: none;">
            <button id="check-btn">√úberpr√ºfen</button>
            <button id="solution-btn">L√∂sung zeigen</button>
            <button id="next-btn">N√§chste Aufgabe</button>
        </div>

        <div class="feedback" id="feedback" style="display: none;"></div>
        <div class="solution" id="solution"></div>

        <div class="stats">
            <div class="stat-item">
                <div class="stat-value" id="correct-count">0</div>
                <div class="stat-label">Richtig</div>
            </div>
            <div class="streak">
                <div class="streak-count"><span class="streak-flame">üî•</span><span id="streak-count">0</span></div>
                <div class="streak-label">Streak</div>
            </div>
            <div class="stat-item">
                <div class="stat-value" id="total-count">0</div>
                <div class="stat-label">Gesamt</div>
            </div>
        </div>
    </div>

    <script>
        // Globale Variablen
        let currentTask = {};
        let difficulty = 'easy';
        let correctCount = 0;
        let totalCount = 0;
        let streakCount = 0;
        let isCorrect = false;

        // DOM-Elemente
        const taskDisplay = document.getElementById('task-display');
        const taskElement = document.getElementById('task');
        const exerciseTypeElement = document.getElementById('exercise-type');
        const inputContainer = document.getElementById('input-container');
        const feedbackElement = document.getElementById('feedback');
        const solutionElement = document.getElementById('solution');
        const buttonsElement = document.getElementById('buttons');
        const correctCountElement = document.getElementById('correct-count');
        const totalCountElement = document.getElementById('total-count');
        const streakCountElement = document.getElementById('streak-count');

        // Event-Listener f√ºr Schwierigkeitsgrad-Buttons
        document.getElementById('easy').addEventListener('click', () => {
            setDifficulty('easy');
        });

        document.getElementById('medium').addEventListener('click', () => {
            setDifficulty('medium');
        });

        document.getElementById('hard').addEventListener('click', () => {
            setDifficulty('hard');
        });

        // Event-Listener f√ºr Action-Buttons
        document.getElementById('check-btn').addEventListener('click', checkAnswer);
        document.getElementById('solution-btn').addEventListener('click', showSolution);
        document.getElementById('next-btn').addEventListener('click', () => {
            generateTask(difficulty);
        });

        // Schwierigkeitsgrad setzen
        function setDifficulty(level) {
            difficulty = level;
            generateTask(level);
            taskDisplay.style.display = 'block';
            buttonsElement.style.display = 'block';
        }

        // Aufgabe generieren
        function generateTask(level) {
            // Eingabefelder und Feedback zur√ºcksetzen
            feedbackElement.style.display = 'none';
            solutionElement.style.display = 'none';

            // Zuf√§llig entscheiden, ob gek√ºrzt oder erweitert werden soll
            const taskType = Math.random() > 0.5 ? 'shorten' : 'expand';

            if (taskType === 'shorten') {
                generateShortenTask(level);
                exerciseTypeElement.textContent = 'K√ºrze den Bruch auf die einfachste Form:';
            } else {
                generateExpandTask(level);
                exerciseTypeElement.textContent = 'Erweitere den Bruch:';
            }
        }

        // Aufgabe zum K√ºrzen generieren
        function generateShortenTask(level) {
            let numDen = generateFraction(level, true);
            let numerator = numDen.numerator;
            let denominator = numDen.denominator;

            // Bruch mit ggT erweitern, um einen k√ºrzbaren Bruch zu erhalten
            const gcd = findGCD(numerator, denominator); // gcd should be 1 here due to generateFraction logic
            let factor;

            switch(level) {
                case 'easy':
                    factor = selectFromRange(2, 5);
                    break;
                case 'medium':
                    factor = selectFromRange(2, 10);
                    break;
                case 'hard':
                    factor = selectFromRange(2, 20);
                    break;
            }

            // Original gek√ºrzter Bruch (L√∂sung)
            const expectedNum = numerator;
            const expectedDen = denominator;
            
            // Angezeigter Bruch (erweitert)
            numerator *= factor;
            denominator *= factor;


            // Aufgabe darstellen
            currentTask = {
                type: 'shorten',
                numerator: numerator,       // Der angezeigte, ungek√ºrzte Z√§hler
                denominator: denominator,   // Der angezeigte, ungek√ºrzte Nenner
                expectedNumerator: expectedNum, // Der erwartete, gek√ºrzte Z√§hler
                expectedDenominator: expectedDen // Der erwartete, gek√ºrzte Nenner
            };

            taskElement.innerHTML = `
                <div class="fraction">
                    <span class="num">${numerator}</span>
                    <span class="den">${denominator}</span>
                </div>
            `;

            // Eingabefelder erstellen (mit neuer Struktur)
            inputContainer.innerHTML = `
                <div class="fraction-input">
                    <div class="fraction">
                        <input type="number" class="num" id="input-num" min="1" required>
                        <div class="fraction-line"></div>
                        <input type="number" class="den" id="input-den" min="1" required>
                    </div>
                </div>
            `;
        }

        // Aufgabe zum Erweitern generieren
        function generateExpandTask(level) {
            let numDen = generateFraction(level, false);
            let numerator = numDen.numerator;
            let denominator = numDen.denominator;

            // Faktor zum Erweitern basierend auf Schwierigkeitsgrad
            let factor;
            switch(level) {
                case 'easy':
                    factor = selectFromRange(2, 5);
                    break;
                case 'medium':
                    factor = selectFromRange(2, 10);
                    break;
                case 'hard':
                    factor = selectFromRange(2, 15);
                    break;
            }

            // Aufgabe darstellen
            currentTask = {
                type: 'expand',
                numerator: numerator,
                denominator: denominator,
                factor: factor,
                expectedNumerator: numerator * factor,
                expectedDenominator: denominator * factor
            };

            taskElement.innerHTML = `
                <div class="fraction">
                    <span class="num">${numerator}</span>
                    <span class="den">${denominator}</span>
                </div>
                <span class="operation">‚Üí</span>
                Erweitere mit ${factor}
            `;

            // Eingabefelder erstellen (mit neuer Struktur)
             inputContainer.innerHTML = `
                <div class="fraction-input">
                    <div class="fraction">
                        <input type="number" class="num" id="input-num" min="1" required>
                        <div class="fraction-line"></div>
                        <input type="number" class="den" id="input-den" min="1" required>
                    </div>
                </div>
            `;
        }

        // Br√ºche generieren basierend auf Schwierigkeitsgrad
        function generateFraction(level, forShorten) {
            let numerator, denominator;

            switch(level) {
                case 'easy':
                    numerator = selectFromRange(1, 10);
                    do {
                        denominator = selectFromRange(2, 10);
                    } while (denominator <= numerator || denominator === 1 || (forShorten && findGCD(numerator, denominator) !== 1)); // Ensure denominator > numerator for proper fraction, avoid 1, ensure it's reducible if forShorten
                    break;

                case 'medium':
                    numerator = selectFromRange(1, 20);
                    do {
                        denominator = selectFromRange(2, 20);
                    } while (denominator <= numerator || denominator === 1 || (forShorten && findGCD(numerator, denominator) !== 1));
                    break;

                case 'hard':
                     numerator = selectFromRange(1, 50);
                    do {
                        denominator = selectFromRange(2, 50);
                    } while (denominator <= numerator || denominator === 1 || (forShorten && findGCD(numerator, denominator) !== 1));
                    break;
            }

            // Bei K√ºrzaufgaben sicherstellen, dass der *Basis*-Bruch (vor dem Erweitern f√ºr die Aufgabe) bereits gek√ºrzt ist.
             if (forShorten) {
                 const gcd = findGCD(numerator, denominator);
                 // Keep numerator and denominator already simplified for the 'expected' result.
                 // The multiplication by 'factor' in generateShortenTask creates the actual problem.
                 // So, this step ensures the base fraction IS simplified.
                 numerator /= gcd;
                 denominator /= gcd;
            }
            // Ensure numerator is smaller than denominator for simpler tasks if not for shortening
            // Or just ensure they are not equal.
             if (numerator === denominator) {
                return generateFraction(level, forShorten); // Regenerate if num === den
             }
             // Optional: ensure proper fractions (num < den) always?
             // if (!forShorten && numerator >= denominator) {
             //    [numerator, denominator] = [denominator, numerator]; // Swap if improper
             // }


            return { numerator, denominator };
        }

        // Zuf√§llige Zahl aus Bereich ausw√§hlen
        function selectFromRange(min, max) {
            return Math.floor(Math.random() * (max - min + 1)) + min;
        }

        // Gr√∂√üter gemeinsamer Teiler (ggT) berechnen (Euklidischer Algorithmus)
        function findGCD(a, b) {
            a = Math.abs(a);
            b = Math.abs(b);
            if (b === 0) return a;
            return findGCD(b, a % b);
        }

        // Antwort √ºberpr√ºfen
        function checkAnswer() {
            const inputNumElement = document.getElementById('input-num');
            const inputDenElement = document.getElementById('input-den');
            
            // Check if elements exist before accessing value
            if (!inputNumElement || !inputDenElement) {
                console.error("Input elements not found!");
                feedbackElement.textContent = 'Fehler: Eingabefelder nicht gefunden.';
                feedbackElement.className = 'feedback incorrect';
                feedbackElement.style.display = 'block';
                return;
            }

            const inputNum = parseInt(inputNumElement.value);
            const inputDen = parseInt(inputDenElement.value);

            if (isNaN(inputNum) || isNaN(inputDen)) {
                feedbackElement.textContent = 'Bitte gib ganze Zahlen f√ºr Z√§hler und Nenner ein!';
                feedbackElement.className = 'feedback incorrect';
                feedbackElement.style.display = 'block';
                return;
            }

            if (inputDen === 0) {
                feedbackElement.textContent = 'Der Nenner darf nicht 0 sein!';
                feedbackElement.className = 'feedback incorrect';
                feedbackElement.style.display = 'block';
                return;
            }
             if (inputDen < 0) {
                feedbackElement.textContent = 'Der Nenner sollte positiv sein. K√ºrze ggf. das Vorzeichen.';
                feedbackElement.className = 'feedback incorrect';
                feedbackElement.style.display = 'block';
                return;
             }


            totalCount++;
            totalCountElement.textContent = totalCount;

            // √úberpr√ºfen, ob die eingegebenen Werte korrekt sind
            if (currentTask.type === 'shorten') {
                // Erwartet wird der vollst√§ndig gek√ºrzte Bruch
                isCorrect = (inputNum === currentTask.expectedNumerator && inputDen === currentTask.expectedDenominator);

                 // Zus√§tzliche Pr√ºfung: Ist die Eingabe zwar wertgleich, aber nicht gek√ºrzt?
                 const inputGCD = findGCD(inputNum, inputDen);
                 const isSimplifiedInput = (inputGCD === 1);
                 const expectedRatio = currentTask.expectedNumerator / currentTask.expectedDenominator;
                 const inputRatio = inputNum / inputDen;
                 const isCorrectRatio = Math.abs(expectedRatio - inputRatio) < 0.0001; // Floating point comparison


                if (isCorrect && isSimplifiedInput) { // Must be the exact expected fraction AND simplified
                    feedbackElement.textContent = 'Richtig!';
                    feedbackElement.className = 'feedback correct';
                    correctCount++;
                    streakCount++;
                } else if (isCorrectRatio && !isSimplifiedInput) {
                     feedbackElement.textContent = `Fast! Der Bruch ${inputNum}/${inputDen} ist zwar wertgleich, aber nicht vollst√§ndig gek√ºrzt. Die richtige L√∂sung ist ${currentTask.expectedNumerator}/${currentTask.expectedDenominator}.`;
                     feedbackElement.className = 'feedback incorrect';
                     streakCount = 0; // Not fully correct
                     isCorrect = false; // Mark as incorrect for potential further logic
                }
                 else {
                    feedbackElement.textContent = `Leider falsch. Die richtige L√∂sung ist ${currentTask.expectedNumerator}/${currentTask.expectedDenominator}.`;
                    feedbackElement.className = 'feedback incorrect';
                    streakCount = 0;
                    isCorrect = false;
                }
            } else { // expand
                // Erwartet wird der exakte erweiterte Bruch
                isCorrect = (inputNum === currentTask.expectedNumerator && inputDen === currentTask.expectedDenominator);

                if (isCorrect) {
                    feedbackElement.textContent = 'Richtig!';
                    feedbackElement.className = 'feedback correct';
                    correctCount++;
                    streakCount++;
                } else {
                    feedbackElement.textContent = `Leider falsch. Die richtige L√∂sung ist ${currentTask.expectedNumerator}/${currentTask.expectedDenominator}.`;
                    feedbackElement.className = 'feedback incorrect';
                    streakCount = 0;
                }
            }

            // Statistik aktualisieren
            correctCountElement.textContent = correctCount;
            streakCountElement.textContent = streakCount;

            feedbackElement.style.display = 'block';
            solutionElement.style.display = 'none'; // Hide solution if check is performed
        }

        // L√∂sung anzeigen
        function showSolution() {
             // Calculate the factor used for shortening if not stored directly
             let shortenFactor = '';
             if (currentTask.type === 'shorten' && currentTask.expectedNumerator !== 0) {
                 shortenFactor = `(gek√ºrzt mit ${currentTask.numerator / currentTask.expectedNumerator})`;
             }


            if (currentTask.type === 'shorten') {
                solutionElement.innerHTML = `
                    <p>L√∂sung:</p>
                    <p>Der Bruch <span class="fraction"><span class="num">${currentTask.numerator}</span><span class="den">${currentTask.denominator}</span></span> gek√ºrzt ergibt <span class="fraction"><span class="num">${currentTask.expectedNumerator}</span><span class="den">${currentTask.expectedDenominator}</span></span> ${shortenFactor}.</p>
                `;
            } else { // expand
                solutionElement.innerHTML = `
                    <p>L√∂sung:</p>
                    <p>Der Bruch <span class="fraction"><span class="num">${currentTask.numerator}</span><span class="den">${currentTask.denominator}</span></span> erweitert mit ${currentTask.factor} ergibt <span class="fraction"><span class="num">${currentTask.expectedNumerator}</span><span class="den">${currentTask.expectedDenominator}</span></span>.</p>
                    <p>${currentTask.numerator} &times; ${currentTask.factor} = ${currentTask.expectedNumerator}</p>
                    <p>${currentTask.denominator} &times; ${currentTask.factor} = ${currentTask.expectedDenominator}</p>
                `;
            }

            solutionElement.style.display = 'block';
            feedbackElement.style.display = 'none'; // Hide feedback when solution is shown
        }

        // Initial state - do not generate task until difficulty is selected
    </script>
</body>
</html>
