<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Aufgabengenerator: Schnittpunkt Gerade & Parabel</title>
    <style>
        /* Modernes & ansprechendes Design für den Generator */
        body {
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            margin: 0;
            background-color: #f0f2f5;
             font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
        }
        #task-generator-container {
            background-color: #ffffff;
            border-radius: 12px;
            padding: 25px 30px;
            width: 100%;
            max-width: 600px;
            margin: 20px;
            box-shadow: 0 6px 24px rgba(0, 0, 0, 0.1);
            border: 1px solid #e0e0e0;
            text-align: center;
        }
        #task-generator-container h2 {
            color: #333;
            margin-bottom: 20px;
            font-size: 1.5em;
        }
        #task-output {
            background-color: #f8f9fa;
            border: 1px solid #dcdcdc;
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 20px;
            min-height: 100px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            font-size: 1.15em;
            color: #495057;
            line-height: 1.6;
        }
        /* Neue Styles für den Input-Bereich */
        #solution-input-container {
            margin-bottom: 20px;
            padding: 15px;
            background-color: #f8f9fa;
            border-radius: 8px;
        }
        #count-input-mask input {
            width: 95%;
            padding: 12px;
            border-radius: 8px;
            border: 1px solid #ccc;
            font-size: 1em;
            text-align: center;
        }
        #calculate-input-mask {
            display: flex;
            flex-direction: column;
            gap: 10px;
            align-items: center;
        }
        .point-input {
            display: flex;
            align-items: center;
            gap: 5px;
            font-size: 1.2em;
            font-weight: bold;
        }
        .coord-input {
            width: 80px;
            padding: 8px;
            border: 1px solid #ccc;
            border-radius: 6px;
            text-align: center;
            font-size: 1em;
        }
        #calculate-input-mask small {
            margin-top: 5px;
            color: #6c757d;
        }
        input[type="number"]:focus,
        input[type="text"]:focus {
            outline: none;
            border-color: #0073aa;
            box-shadow: 0 0 0 2px rgba(0, 115, 170, 0.2);
        }
        #feedback-output {
            margin-top: 15px;
            min-height: 20px;
            font-weight: bold;
        }
        .correct {
            color: #28a745;
        }
        .incorrect {
            color: #dc3545;
        }
        #answer-output {
            background-color: #e9f5e9;
            border: 1px solid #c8e6c9;
            color: #2e7d32;
            border-radius: 8px;
            padding: 15px;
            margin-top: 20px;
            font-weight: bold;
            text-align: left;
            transition: all 0.3s ease;
        }
        .button-container {
            display: flex;
            justify-content: center;
            gap: 15px; /* Abstand zwischen den Buttons */
            flex-wrap: wrap;
        }
        .generator-button {
            background: linear-gradient(145deg, #0078b3, #005f8e);
            color: white;
            border: none;
            border-radius: 8px;
            padding: 12px 24px;
            font-size: 16px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
        }
        .generator-button:hover {
            transform: translateY(-3px);
            box-shadow: 0 6px 12px rgba(0,0,0,0.15);
        }
         .generator-button:active {
            transform: translateY(-1px);
            box-shadow: 0 2px 6px rgba(0,0,0,0.15);
        }
        .secondary-button {
             background: linear-gradient(145deg, #737c85, #5a6268);
        }
        .check-button {
             background: linear-gradient(145deg, #28a745, #218838);
        }
        .geogebra-button {
             background: linear-gradient(145deg, #4a90e2, #2c6eb5);
        }
        /* Style für die Gleichungen (jetzt keine Links mehr) */
        .equation {
            font-weight: bold;
            font-family: 'Courier New', Courier, monospace;
            color: #005a87;
            display: block; 
            margin: 8px 0;
            background-color: #eef8ff;
            padding: 10px 15px;
            border-radius: 8px;
        }
    </style>
</head>
<body>

<div id="task-generator-container">
    <h2>Aufgabengenerator: Schnittpunkt Gerade & Parabel</h2>
    <div id="task-output">Klicke auf "Neue Aufgabe", um zu starten!</div>

    <div id="solution-input-container">
        <!-- Maske für 'Anzahl' Aufgabe -->
        <div id="count-input-mask" style="display: none;">
            <input type="number" id="count-input" placeholder="Anzahl hier eingeben...">
        </div>
        <!-- Maske für 'Berechne' Aufgabe -->
        <div id="calculate-input-mask" style="display: none;">
            <div class="point-input">
                <span>P1 (&nbsp;</span>
                <input type="text" class="coord-input" id="p1x-input" placeholder="x">
                <span>&nbsp;|&nbsp;</span>
                <input type="text" class="coord-input" id="p1y-input" placeholder="y">
                <span>&nbsp;)</span>
            </div>
            <div class="point-input">
                <span>P2 (&nbsp;</span>
                <input type="text" class="coord-input" id="p2x-input" placeholder="x">
                <span>&nbsp;|&nbsp;</span>
                <input type="text" class="coord-input" id="p2y-input" placeholder="y">
                <span>&nbsp;)</span>
            </div>
            <small>Lasse Felder leer, falls es keine oder nur einen Schnittpunkte gibt.</small>
        </div>
        <div id="feedback-output"></div>
    </div>

    <div class="button-container">
        <button class="generator-button" onclick="generateNewTask()">Neue Aufgabe</button>
        <button class="generator-button check-button" onclick="checkSolution()">Lösung prüfen</button>
        <button class="generator-button secondary-button" onclick="showAnswer()">Lösung anzeigen</button>
        <button class="generator-button geogebra-button" onclick="openGeoGebra()">In GeoGebra zeichnen</button>
    </div>
    <div id="answer-output" style="display: none;"></div>
</div>

<script>
    let currentSolution = {}; // Objekt für die strukturierte Lösung
    let formattedSolution = ""; // String für die Anzeige der Lösung
    let currentTaskType = ""; // 'calculate' oder 'count'
    let currentGeoGebraURL = ""; // Globale Variable für die GeoGebra URL

    // Funktion zur Vereinfachung der Darstellung von Termen
    function formatTerm(coeff, variable, isFirst = false) {
        if (coeff === 0) return "";
        let sign = isFirst ? "" : (coeff > 0 ? " + " : " - ");
        if (isFirst && coeff < 0) sign = "-";
        
        const absCoeff = Math.abs(coeff);
        const coeffStr = (absCoeff === 1 && variable) ? "" : absCoeff;

        return `${sign}${coeffStr}${variable}`;
    }

    // Hilfsfunktion zum sauberen Formatieren einer ganzen Gleichung
    function formatEquation(parts) {
        let equationStr = parts.filter(p => p).join(''); // Filtere leere Teile und verbinde sie
        if (!equationStr) return "0";
        if (equationStr.startsWith(" + ")) {
            equationStr = equationStr.substring(3);
        }
        return equationStr.trim();
    }
    
    // Funktion zum Öffnen von GeoGebra
    function openGeoGebra() {
        if (currentGeoGebraURL) {
            window.open(currentGeoGebraURL, '_blank');
        }
    }

    function generateNewTask() {
        // Reset UI
        document.getElementById('answer-output').style.display = 'none';
        document.getElementById('feedback-output').innerHTML = '';
        currentGeoGebraURL = ""; // Reset URL
        ['count-input', 'p1x-input', 'p1y-input', 'p2x-input', 'p2y-input'].forEach(id => {
            const el = document.getElementById(id);
            if (el) el.value = '';
        });

        // --- LOGIK ZUR EXPLIZITEN STEUERUNG DER LÖSUNGSANZAHL ---
        let a_sol, b_sol, c_sol;
        const solutionType = Math.random();

        if (solutionType < 0.2) { // 20% Chance: 0 Lösungen
            do {
                a_sol = (Math.floor(Math.random() * 4) + 1) * (Math.random() < 0.5 ? 1 : -1);
                b_sol = Math.floor(Math.random() * 9) - 4;
                c_sol = (Math.floor(Math.random() * 4) + 1) * (Math.random() < 0.5 ? 1 : -1);
            } while (b_sol * b_sol - 4 * a_sol * c_sol >= 0);
        } else if (solutionType < 0.5) { // 30% Chance: 1 Lösung
            const d = (Math.floor(Math.random() * 3) + 1);
            const n = Math.floor(Math.random() * 9) - 4;
            a_sol = d * d * (Math.random() < 0.5 ? 1 : -1);
            if (a_sol === 0) a_sol = 1;
            b_sol = -2 * d * n;
            c_sol = n * n;
            const factor = (Math.floor(Math.random() * 2) + 1);
            a_sol *= factor; b_sol *= factor; c_sol *= factor;
        } else { // 50% Chance: 2 Lösungen
            const denoms = [1, 2, 4];
            const d1 = denoms[Math.floor(Math.random() * denoms.length)];
            let n1 = Math.floor(Math.random() * 9) - 4;
            const d2 = denoms[Math.floor(Math.random() * denoms.length)];
            let n2 = Math.floor(Math.random() * 9) - 4;
            
            if (n1/d1 === n2/d2) {
                n2++; 
                if (n2 > 4) n2 = -4;
            }
            const x1 = n1 / d1;
            const x2 = n2 / d2;
            
            a_sol = d1 * d2 * (Math.random() < 0.5 ? 1 : -1);
            if (a_sol === 0) a_sol = 1;
            b_sol = -a_sol * (x1 + x2);
            c_sol = a_sol * x1 * x2;
        }

        const randomOneDecimal = (max, min = 0) => (Math.floor(Math.random() * (max * 10 - min * 10 + 1)) + min * 10) / 10;
        
        const p_a = a_sol; 
        const p_b = randomOneDecimal(5, -5);
        const g_m = Math.round((p_b - b_sol) * 10) / 10;
        const p_c = randomOneDecimal(10, -10);
        const g_b = Math.round((p_c - c_sol) * 10) / 10;
        
        const parabola_str = formatEquation([
            formatTerm(p_a, 'x²', true),
            formatTerm(p_b, 'x'),
            formatTerm(p_c, '')
        ]);
        const line_str = formatEquation([
            formatTerm(g_m, 'x', true),
            formatTerm(g_b, '')
        ]);
        const parabola_eq_display = `p: y = ${parabola_str}`;
        const line_eq_display = `g: y = ${line_str}`;
        
        // --- GEOGEBRA URL ERSTELLEN (FINALE KORREKTUR) ---
        const geogebra_parabola = parabola_str.replace(/x²/g, 'x^2');
        const geogebra_line = line_str.replace(/x²/g, 'x^2');
        const combined_commands = `f(x)=${geogebra_parabola};g(x)=${geogebra_line}`;
        currentGeoGebraURL = `https://www.geogebra.org/graphing?command=${encodeURIComponent(combined_commands)}`;

        const final_diskriminante = b_sol * b_sol - 4 * a_sol * c_sol;
        currentTaskType = Math.random() < 0.6 ? 'calculate' : 'count';
        
        let taskText = currentTaskType === 'calculate' 
            ? "Berechne die Schnittpunkte der Parabel und der Geraden:<br><small>(Runde deine Ergebnisse auf zwei Nachkommastellen.)</small>" 
            : "Bestimme die Anzahl der Schnittpunkte der Parabel und der Geraden:";

        document.getElementById('task-output').innerHTML = `
            ${taskText}
            <div class="equation">${parabola_eq_display}</div>
            <div class="equation">${line_eq_display}</div>
        `;
        
        const countMask = document.getElementById('count-input-mask');
        const calculateMask = document.getElementById('calculate-input-mask');
        if (currentTaskType === 'count') {
            countMask.style.display = 'block';
            calculateMask.style.display = 'none';
        } else {
            countMask.style.display = 'none';
            calculateMask.style.display = 'block';
        }

        // Lösungsobjekt und Anzeigetext erstellen
        if (final_diskriminante < -0.001) {
            currentSolution = { count: 0, points: [] };
            formattedSolution = "Es gibt keine Schnittpunkte.";
        } else if (Math.abs(final_diskriminante) < 0.001) {
            const x = -b_sol / (2 * a_sol);
            const y = g_m * x + g_b;
            const p = { x: Math.round(x * 100) / 100, y: Math.round(y * 100) / 100 };
            currentSolution = { count: 1, points: [p] };
            formattedSolution = `Es gibt einen Berührpunkt: P(${p.x}|${p.y})`;
        } else {
            const x1 = (-b_sol + Math.sqrt(final_diskriminante)) / (2 * a_sol);
            const y1 = g_m * x1 + g_b;
            const x2 = (-b_sol - Math.sqrt(final_diskriminante)) / (2 * a_sol);
            const y2 = g_m * x2 + g_b;
            const p1 = { x: Math.round(x1 * 100) / 100, y: Math.round(y1 * 100) / 100 };
            const p2 = { x: Math.round(x2 * 100) / 100, y: Math.round(y2 * 100) / 100 };
            currentSolution = { count: 2, points: [p1, p2] };
            formattedSolution = `Die Schnittpunkte sind P1(${p1.x}|${p1.y}) und P2(${p2.x}|${p2.y})`;
        }
    }
    
    function checkSolution() {
        const feedbackDiv = document.getElementById('feedback-output');
        let isCorrect = false;

        if (currentTaskType === 'count') {
            const userInput = document.getElementById('count-input').value;
            if (userInput === "") {
                 feedbackDiv.textContent = "Bitte gib eine Anzahl ein.";
                 feedbackDiv.className = 'incorrect';
                 return;
            }
            isCorrect = (parseInt(userInput) === currentSolution.count);
        } else { // 'calculate' task
            const p1x = parseFloat(document.getElementById('p1x-input').value.replace(',', '.'));
            const p1y = parseFloat(document.getElementById('p1y-input').value.replace(',', '.'));
            const p2x = parseFloat(document.getElementById('p2x-input').value.replace(',', '.'));
            const p2y = parseFloat(document.getElementById('p2y-input').value.replace(',', '.'));

            const userPoints = [];
            if (!isNaN(p1x) && !isNaN(p1y)) userPoints.push({ x: p1x, y: p1y });
            if (!isNaN(p2x) && !isNaN(p2y)) userPoints.push({ x: p2x, y: p2y });
            
            if (currentSolution.count !== userPoints.length) {
                isCorrect = false;
            } else {
                if (currentSolution.count === 0) {
                    isCorrect = true;
                } else if (currentSolution.count === 1) {
                    const solP = currentSolution.points[0];
                    const userP = userPoints[0];
                    isCorrect = Math.abs(solP.x - userP.x) < 0.01 && Math.abs(solP.y - userP.y) < 0.01;
                } else if (currentSolution.count === 2) {
                    const solP1 = currentSolution.points[0];
                    const solP2 = currentSolution.points[1];
                    const userP1 = userPoints[0];
                    const userP2 = userPoints[1];
                    
                    const matchDirect = (Math.abs(solP1.x - userP1.x) < 0.01 && Math.abs(solP1.y - userP1.y) < 0.01) && (Math.abs(solP2.x - userP2.x) < 0.01 && Math.abs(solP2.y - userP2.y) < 0.01);
                    const matchSwapped = (Math.abs(solP1.x - userP2.x) < 0.01 && Math.abs(solP1.y - userP2.y) < 0.01) && (Math.abs(solP2.x - userP1.x) < 0.01 && Math.abs(solP2.y - userP1.y) < 0.01);

                    isCorrect = matchDirect || matchSwapped;
                }
            }
        }

        if(isCorrect) {
            feedbackDiv.textContent = 'Richtig!';
            feedbackDiv.className = 'correct';
        } else {
            feedbackDiv.textContent = 'Leider falsch. Überprüfe deine Rechnung und versuche es erneut!';
            feedbackDiv.className = 'incorrect';
        }
    }

    function showAnswer() {
        const answerDiv = document.getElementById('answer-output');
        const solutionText = currentTaskType === 'calculate' ? formattedSolution : `Anzahl der Schnittpunkte: ${currentSolution.count}`;
        answerDiv.innerHTML = `<strong>Korrekte Lösung:</strong> ${solutionText}`;
        answerDiv.style.display = 'block';
    }
    
    window.onload = generateNewTask;

</script>

</body>
</html>

